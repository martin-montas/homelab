---
- name: Docker housekeeping â€“ prune unused resources
  hosts: all
  become: true
  gather_facts: false

  tasks:
    - name: Confirm playbook execution
      debug:
        msg: "Starting Docker prune on {{ inventory_hostname }}"

    - name: Prune unused Docker objects
      command: >
        docker system prune -af --volumes
      register: prune_output
      changed_when: "'Total reclaimed space' in prune_output.stdout"

    - name: Show reclaimed space
      debug:
        var: prune_output.stdout
